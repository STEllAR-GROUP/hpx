language: cpp

compiler:
    - gcc
    - clang

env:
    - BUILD_TYPE=Debug
    - BUILD_TYPE=Release
    
branches:
    only:
        - travis

before_install:
    # more recent compilers
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    # more recent cmake
    - sudo add-apt-repository -y ppa:kalakris/cmake
    # more recent boost
    - sudo add-apt-repository -y ppa:apokluda/boost1.53
    - sudo apt-get update -qq
    - sudo apt-get install -qq cmake
    - sudo apt-get install -qq libboost1.53-all-dev
    - sudo apt-get install -qq libjemalloc-dev
    - sudo apt-get install -qq libhwloc-dev
    - export NUM_BUILDCORES=`grep -c ^processor /proc/cpuinfo`

script:
    - mkdir build
    - cd build
    - cmake .. -DCMAKE_BUILD_TYPE=${BUILD_TYPE} -DHPX_MALLOC=jemalloc -DCMAKE_INSTALL_PREFIX:PATH=${PWD}/../ -DHPX_BUILD_EXAMPLES=On
    - make core -j 2
    - make -k components -j 2
    - make -k examples -j 2
    - make -k tests.unit -j 2
    - make -k tests.regressions -j 2
    - make -k tests.performance -j 2
    - make install
    
notifications:
    email: false
