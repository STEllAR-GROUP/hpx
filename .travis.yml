language: cpp

compiler:
    - gcc
    - clang

env:
    - BUILD_TYPE=Debug
    - BUILD_TYPE=Release
    
branches:
    only:
        - travis

before_install:
    # more recent compilers
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    # more recent cmake
    - sudo add-apt-repository -y ppa:kalakris/cmake
    # more recent boost
    - sudo add-apt-repository -y ppa:apokluda/boost1.53
    - sudo apt-get update -qq
    - sudo apt-get install -qq cmake
    - sudo apt-get install -qq libboost1.53-all-dev
    - sudo apt-get install -qq libjemalloc-dev
    - sudo apt-get install -qq libhwloc-dev
    - if [ "$CXX" = "clang++" ]; then sudo apt-get install -qq libstdc++-4.8-dev clang-3.5; fi
    - if [ "$CXX" = "g++" ]; then sudo apt-get install -qq libstdc++-4.9-dev g++-4.9; fi
    - if [ "$CXX" = "g++" ]; then export CXX="g++-4.9" CC="gcc-4.9"; fi
    #- export NUM_BUILDCORES=`grep -c ^processor /proc/cpuinfo`

before_script:
    - mkdir build
    - cd build
    - cmake .. -DCMAKE_BUILD_TYPE=${BUILD_TYPE} -DHPX_MALLOC=jemalloc -DCMAKE_INSTALL_PREFIX:PATH=${PWD}/../ -DHPX_BUILD_EXAMPLES=On
    - make core

script:
    - make -k components
    #- make -k examples
    #- make -k tests.unit
    #- make -k tests.regressions
    #- make -k tests.performance
    - make install
    
notifications:
    email: false
